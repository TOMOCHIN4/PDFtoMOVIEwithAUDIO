# PLAN.md - プロジェクト計画書

## プロジェクト概要

**PDFtoMOVIEwithAUDIO** は、PDFドキュメントをAIナレーション付き動画に自動変換するHugging Face Spaces Gradioアプリケーションです。

### ビジョン
静的なPDFコンテンツを、プロフェッショナルなAIナレーション付きの魅力的なマルチメディアプレゼンテーションに変換し、コンテンツのアクセシビリティと教育効果を高める。

---

## 技術アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                      Gradio UI (Frontend)                    │
├─────────────────────────────────────────────────────────────┤
│  PDF Upload │ Style Selection │ API Keys │ Generate Button  │
└──────────────────────────┬──────────────────────────────────┘
                           │
┌──────────────────────────▼──────────────────────────────────┐
│                   Processing Pipeline                        │
├─────────────────────────────────────────────────────────────┤
│  1. PDF Split → 2. Image Extract → 3. Script Gen (Gemini)   │
│  4. TTS Audio → 5. Audio Process → 6. Video Create          │
└──────────────────────────┬──────────────────────────────────┘
                           │
┌──────────────────────────▼──────────────────────────────────┐
│                   Output & Storage                           │
├─────────────────────────────────────────────────────────────┤
│        MP4 Video (1920x1080) → Hugging Face Dataset         │
└─────────────────────────────────────────────────────────────┘
```

---

## フェーズ別計画

### Phase 0: ビルド・起動 ✅ 完了
- [x] ビルドエラーの特定（websockets競合）
- [x] ビルドエラーの解消（gradio 5.9.1へ更新）
- [x] moviepy 2.x対応（インポート修正）
- [x] 環境シークレット対応（GEMINI_API_KEY, HF_TOKEN）
- [x] GitHub → HF Space 自動同期設定
- [x] HF Spacesでの起動確認
- [x] Gradio SSRエラー解消（ssr_mode=False）
- [x] 基本的な画面表示確認

### Phase 1: 基盤構築・動作確認 🔴 現在のフェーズ（テスト中）
- [x] google-genai API互換性修正（Part.from_text キーワード引数）
- [x] moviepy 2.x互換性修正（verbose引数削除）
- [x] 動画結合高速化（ffmpeg concat、10倍高速）
- [x] 台本生成モデル強化（gemini-3-flash-preview）
- [x] 台本生成プロンプト強化（PDF認識・具体性要求）
- [x] PDF処理パイプライン動作確認
- [x] TTS音声生成確認
- [x] 動画生成・結合確認
- [ ] Gemini API連携確認（スクリプト生成品質）← テスト中
- [ ] Hugging Face Dataset連携確認
- [ ] 各プログラムスタイルの動作確認

### Phase 2: 安定性向上 📋 計画中
- [ ] APIコールのリトライ機構
- [ ] エラーハンドリングの強化
- [ ] 処理の中断・再開機能
- [ ] 一時ファイルのクリーンアップ改善

### Phase 3: ユーザー体験向上 📋 計画中
- [ ] UIでの音声速度調整
- [ ] UIでの無音時間調整
- [ ] 動画品質/解像度選択
- [ ] プログレスバーの詳細化
- [ ] プレビュー機能

### Phase 4: 機能拡張 📋 将来計画
- [ ] 多言語対応（英語、中国語等）
- [ ] カスタムスタイル作成機能
- [ ] バッチ処理（複数PDF同時処理）
- [ ] 音声・スクリプトのキャッシュ機能
- [ ] BGM追加オプション

### Phase 5: 高度な機能 📋 将来計画
- [ ] 字幕自動生成
- [ ] 話者アバター表示
- [ ] インタラクティブ動画出力
- [ ] API提供（外部サービス連携）

---

## 技術スタック

| カテゴリ | 技術 | 用途 |
|---------|------|------|
| UI | Gradio 5.9.1 | Webインターフェース |
| AI（スクリプト） | Gemini 3 Flash Preview | ナレーション台本生成 |
| AI（音声） | Gemini 2.5 Flash TTS | テキスト読み上げ |
| PDF処理 | PyMuPDF, pdf2image | PDF操作・画像変換 |
| 画像処理 | Pillow | リサイズ・加工 |
| 音声処理 | pydub | 速度調整・無音挿入 |
| 動画生成 | moviepy, ffmpeg | MP4生成・結合 |
| ストレージ | Hugging Face Hub | クラウド保存 |
| CI/CD | GitHub Actions | HF Space自動同期 |

---

## 設計原則

1. **モジュラー設計**: 各処理段階を独立した関数として実装
2. **プログレス可視化**: ユーザーに処理状況を常に表示
3. **エラー耐性**: 失敗時も可能な限り処理を継続
4. **柔軟性**: 設定値の変更で動作をカスタマイズ可能
5. **日本語優先**: UI・ナレーションは日本語を主言語とする

---

## 設定パラメータ

```python
PAGES_PER_CHUNK = 5          # PDF分割単位
AUDIO_SPEED = 1.2            # 再生速度
SILENCE_BEFORE = 1000        # 前無音（ms）
SILENCE_AFTER = 500          # 後無音（ms）
OUTPUT_FPS = 24              # 動画フレームレート
OUTPUT_RESOLUTION = (1920, 1080)  # 動画解像度
```

---

## プログラムスタイル

| スタイル | 話者数 | 説明 |
|---------|--------|------|
| 1人ラジオ風 | 1人 | 親しみやすいラジオパーソナリティ |
| 2人ポッドキャスト風 | 2人 | ホストとアシスタントの対話 |
| 2人漫才風 | 2人 | ボケとツッコミのコメディ |
| 1人ニュース風 | 1人 | フォーマルなニュースキャスター |
| 1人講義風 | 1人 | 教授による学術的解説 |
| 2人インタビュー風 | 2人 | 専門家へのQ&A形式 |

---

## 今後の検討事項

- コスト最適化（API呼び出し回数の削減）
- 処理時間の短縮（並列処理の導入）
- オフライン対応（ローカルTTSモデル使用）
- モバイル対応UI

---

*最終更新: 2025-12-28*
